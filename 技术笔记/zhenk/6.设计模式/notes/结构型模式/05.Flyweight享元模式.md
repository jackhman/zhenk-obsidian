> [!TIPS] 简介
> 亦称： 缓存、Cache、Flyweight
> * 利用共享的方式来支持大量细粒度的对象，这些对象一部分内部状态是相同的。
> * 客户端代码不会知道任何事情， 因为重用享元对象的复杂机制隐藏在了享元工厂中。

## 结构
![[享元模式结构图.png]]
- Flyweight：享元对象
- IntrinsicState：内部状态，享元对象共享内部状态
- ExtrinsicState：外部状态，每个享元对象的外部状态不同

### 组合对象作为某享元
较复杂的享元模式是其中某个享元对象是由组合对象组成的。
![[其中享元元素对象可由组合模式创建.png]]




## 应用
### JDK
Java 利用缓存来加速大量小对象的访问时间。
- java.lang.Integer#valueOf(int)
- java.lang.Boolean#valueOf(boolean)
- java.lang.Byte#valueOf(byte)
- java.lang.Character#valueOf(char)
- [`java.lang.Integer#valueOf(int)`](http://docs.oracle.com/javase/8/docs/api/java/lang/Integer.html#valueOf-int-) （以及 [`Boolean`](http://docs.oracle.com/javase/8/docs/api/java/lang/Boolean.html#valueOf-boolean-)、 [`Byte`](http://docs.oracle.com/javase/8/docs/api/java/lang/Byte.html#valueOf-byte-)、 [`Character`](http://docs.oracle.com/javase/8/docs/api/java/lang/Character.html#valueOf-char-)、 [`Short`](http://docs.oracle.com/javase/8/docs/api/java/lang/Short.html#valueOf-short-)、 [`Long`](http://docs.oracle.com/javase/8/docs/api/java/lang/Long.html#valueOf-long-) 和 [`Big­Decimal`](https://docs.oracle.com/javase/8/docs/api/java/math/BigDecimal.html#valueOf-long-int-)）
```java
    String s1 = "abc";  
    String s2 = "abc";  
    // 在JVM中，字符串常量池，放在不同堆中位置引用常量池字符串常量，s3和s4在堆中的对常量池引用是不一样的。
    String s3 = new String("abc");  
    String s4 = new String("abc");  
  
    System.out.println(s1 == s2); //true  
    System.out.println(s1 == s3); //false  
    System.out.println(s3 == s4); // false  
    // intern指的是内部指向常量池的引用   
    System.out.println(s3.intern() == s1); // true  
    System.out.println(s3.intern() == s4.intern()); // true  
}
```

## 识别方法
**识别方法：** 享元可以通过构建方法来识别， 它会返回缓存对象而不是创建新的对象。

## 栗子
### [渲染一片森林](代码栗子.md#渲染一片森林)