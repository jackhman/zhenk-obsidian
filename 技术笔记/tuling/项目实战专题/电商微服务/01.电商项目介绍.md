> [!TIP] 课程介绍
> 一个大型互联网电商项目从需求设计，到架构落地，再到调优上线的全流程。
## 项目整体架构

![[项目整体架构.png]]

## 运行环境
NodeJS 、 MySQL 、 Nacos 、Redis集群、 Nginx 、RocketMQ 集群、ElasticSearch、 Mongodb
### 电商相关服务列表
|   |   |   |   |
|---|---|---|---|
|软件名称|版本||备注|
|MySQL|8.0||必选|
|Redis|5.0||必选|
|ElasticSearch|7.6.1||必选|
|Nacos|2.1.0||必选|
|RocketMQ|4.x||必选|
|MongoDB|||可选|
|xxljob|||可选|
|canal|||可选|
|nginx|||可选|

## 相关技术
### 学到技术
* 分库分表、读写分离
* 分布式事务
* 全局唯一性ID
* 分布式Session
* 分布式链路跟踪
* 日志收集与展示
* 商品搜索
* 分布式锁
* 服务降级/限流/熔断/隔离
* 页面静态化
* 分布式任务调度
* 数据迁移方案
* 数据同步方案
* 多级缓存、缓存预热
* 高并发秒杀系统实现（秒杀系统的商详页静态化、秒杀系统的隔离、秒杀的削峰和限流等等）

### 前置技术
* 并发编程
* SpringBoot + Mybatis + MySQL 下的WEB应用开发
* 图灵商城项目单体版
* 分布式基本概念
* 微服务的基本概念
* 事务一致性概念、多副本一致概念和CAP理论
* SpingCloudAlibaba系列组件（Nacos、Seata等等）的作用和基本使用
* Redis各种数据结构和操作、Redis主从和Redis Cluster基本概念
* Lua语言的基础语法
* MongoDB基本概念和操作、MongoDB集群基本概念
* 消息中间件的基本概念和RocketMQ的基本操作、RocketMQ集群基本概念
* ELK的基本概念和基本使用
* JavaScript基础语法
* Linux的基本概念和操作
* Nginx基本概念和操作
* Git的基本操作和Maven基本配置方法和常用命令

## 课程内容升级
[图灵大型微服务电商平台实战](图灵大型微服务电商平台实战.md)


## 建议机器配置
CentOS7服务两台。

一台用于配置项目运行所必须的基础服务(必选)，基于 Docker 部署关键服务。部署过程参见提供的 Docker 脚本。 

如果统一部署所有基础服务，建议配置不低于 8核16G 内存

另外一台用于部署补充服务(可选)。如xxljob,filebeat,openresty等或者尝试在服务器上运行电商项目。具体服务部署情况参见课程

## 基础服务搭建脚本
【腾讯文档】图灵云服务Docker搭建 按照这个教程搭建docker 

[图灵云服务Docker搭建](02.项目实战环境部署.md)

请注意需要使用docker compose进行部署    docker 源  使用  阿里云即可 

所有的compose 文件请命名：docker-compose.yml 并且执行命令统一为 

```shell
yum install docker-compose
```

```shell
docker-compose up -d
```

建议每个文件一个目录 进行执行

### mysql 部署docker集群 

```yml
version: '3.1'

services:
  mysql-master:
    image: mysql:8.0
    environment:
      MYSQL_ROOT_PASSWORD: masterpassword
      MYSQL_DATABASE: mydb
    ports:
      - "3306:3306"
    #如果要挂载目录文件请释放开此配置 如果使用阿里云会报错请注释此内容
  # volumes:
  #  - ./mysql:/var/lib/mysql
    
    
    command: --server-id=1 --log-bin=mysql-bin --binlog-format=ROW --default-authentication-plugin=mysql_native_password

  mysql-slave:
    image: mysql:8.0
    environment:
      MYSQL_ROOT_PASSWORD: slavepassword
      MYSQL_DATABASE: mydb
    ports:
      - "3307:3306"
    #如果要挂载目录文件请释放开此配置如果使用阿里云会报错请注释此内容
  # volumes:
   #  - ./mysqls:/var/lib/mysql

    command: --server-id=2 --default-authentication-plugin=mysql_native_password
    depends_on:
      - mysql-master

  setup-master-slave:
    image: mysql:8.0
    environment:
      MYSQL_ROOT_PASSWORD: masterpassword
    depends_on:
      - mysql-master
      - mysql-slave
    command: >
      bash -c "
        echo 'Setting up master-slave replication...';
        sleep 60;
        MYSQL_PWD=masterpassword mysql -h mysql-master -uroot -e '
          CREATE USER \"replica\"@\"%\" IDENTIFIED WITH mysql_native_password BY \"replicapassword\";
          GRANT REPLICATION SLAVE ON *.* TO \"replica\"@\"%\";
          FLUSH PRIVILEGES;
          FLUSH TABLES WITH READ LOCK;
          SHOW MASTER STATUS\G' > master_status;
        MASTER_LOG_FILE=\$$(cat master_status | grep File: | awk '{print \$$2}');
        MASTER_LOG_POS=\$$(cat master_status | grep Position: | awk '{print \$$2}');
        MYSQL_PWD=slavepassword mysql -h mysql-slave -uroot -e '
          CHANGE MASTER TO MASTER_HOST=\"mysql-master\", MASTER_USER=\"replica\", MASTER_PASSWORD=\"replicapassword\", MASTER_LOG_FILE='\$$MASTER_LOG_FILE', MASTER_LOG_POS='\$$MASTER_LOG_POS';
          START SLAVE;';
        echo 'Replication setup complete.';
      "


```

请记得要创建 mysql 以及mysqls 这两个目录

### redis集群搭建
```yml
version: '2.2'

services:
  redis-node1:
    image: redis:5.0
    ## --cluster-announce-ip 你的公网IP 这部分参数 应对的是部分小伙伴用的 阿里云服务器出现网卡回环的问题 如果没有问题 可以不用写这个 

    command: redis-server --port 7000 --cluster-enabled yes --cluster-config-file /data/nodes.conf --appendonly yes --bind 0.0.0.0  --cluster-announce-ip 你的公网IP
    ports:
      - "7000:7000"
      - "17000:17000"
    volumes:
      - ./data/node1:/data
    networks:
      - redis-cluster

  redis-node2:
    image: redis:5.0
    command: redis-server --port 7001 --cluster-enabled yes --cluster-config-file /data/nodes.conf --appendonly yes --bind 0.0.0.0 --cluster-announce-ip 你的公网IP
    ports:
      - "7001:7001"
      - "17001:17001"
    volumes:
      - ./data/node2:/data
    networks:
      - redis-cluster

  redis-node3:
    image: redis:5.0
    command: redis-server --port 7002 --cluster-enabled yes --cluster-config-file /data/nodes.conf --appendonly yes --bind 0.0.0.0 --cluster-announce-ip 你的公网IP
    ports:
      - "7002:7002"
      - "17002:17002"
    volumes:
      - ./data/node3:/data
    networks:
      - redis-cluster

  redis-node4:
    image: redis:5.0
    command: redis-server --port 7003 --cluster-enabled yes --cluster-config-file /data/nodes.conf --appendonly yes --bind 0.0.0.0 --cluster-announce-ip 你的公网IP
    ports:
      - "7003:7003"
      - "17003:17003"
    volumes:
      - ./data/node4:/data
    networks:
      - redis-cluster

  redis-node5:
    image: redis:5.0
    command: redis-server --port 7004 --cluster-enabled yes --cluster-config-file /data/nodes.conf --appendonly yes --bind 0.0.0.0 --cluster-announce-ip 你的公网IP
    ports:
      - "7004:7004"
      - "17004:17004"
    volumes:
      - ./data/node5:/data
    networks:
      - redis-cluster

  redis-node6:
    image: redis:5.0
    command: redis-server --port 7005 --cluster-enabled yes --cluster-config-file /data/nodes.conf --appendonly yes --bind 0.0.0.0 --cluster-announce-ip 你的公网IP
    ports:
      - "7005:7005"
      - "17005:17005"
    volumes:
      - ./data/node6:/data
    networks:
      - redis-cluster
  redis-init:
    image: redis:5.0
    command: >
      sh -c "redis-server --port 7000 --cluster-enabled yes --cluster-config-file /data/nodes.conf --appendonly yes --bind $$(hostname -i)
      && sleep 5
      && redis-cli --cluster create redis-node1:7000 redis-node2:7001 redis-node3:7002 redis-node4:7003 redis-node5:7004 redis-node6:7005 --cluster-replicas 1"
    depends_on:
      - redis-node1
    networks:
      - redis-cluster

networks:
  redis-cluster:
```
如果 你的集群起来不是自动的集群 请 进入容器执行这部分命令  IP写自己的IP

```shell
redis-cli --cluster create IP:7000 IP:7001 IP:7002 IP:7003 IP:7004 IP:7005 --cluster-replicas 1
```

# --cluster-announce-ip 你的公网IP

### ES 和Kibaba

```yml
version: '2.2'

services:
	elasticsearch:
		image: docker.elastic.co/elasticsearch/elasticsearch:7.6.1
		container_name: elasticsearch
		environment:
			- discovery.type=single-node
		ports:
			- "9200:9200"
			- "9300:9300"
		volumes:
			- elasticsearch-data:/usr/share/elasticsearch/data
	kibana:
		image: docker.elastic.co/kibana/kibana:7.6.1
		container_name: kibana
		environment:
			- ELASTICSEARCH_URL=http://elasticsearch:9200
		ports:
			- "5601:5601"
		depends_on:
			- elasticsearch
volumes:
	elasticsearch-data:
```

### nacos
```yml
version: '2.2'
services:
	nacos-server:
		image: nacos/nacos-server:v2.1.0
		container_name: nacos-server
		ports:
			- "8848:8848"
			- "9848:9848"
		environment:
			- MODE=cluster
			- SPRING_DATASOURCE_PLATFORM=mysql
			- MYSQL_SERVICE_HOST=mysql-db
			- MYSQL_SERVICE_PORT=3306
			- MYSQL_SERVICE_DB_NAME=nacos
			- MYSQL_SERVICE_USER=nacos
			- MYSQL_SERVICE_PASSWORD=nacospassword
		depends_on:
			- mysql-db
```

#### 数据库部分填写自己的

![[nacos中sql部分填写自己的.png]]

#### 如果不用数据库请用下列配置文件
```yml
version: "3"
services:
  nacos-server:
    image: nacos/nacos-server:v2.1.0
    container_name: nacos-server
    ports:
      - "8848:8848"
      - "9848:9848"
    environment:
      - MODE=standalone  # 使用独立模式，不依赖数据库
```

### rocketMQ
```yml
version: '2.2'

services:
  namesrv:
    image: apache/rocketmq:4.8.0
    container_name: rocketmq-namesrv
    ports:
      - "9876:9876"
    command: "sh mqnamesrv"

  broker:
    image: apache/rocketmq:4.8.0
    container_name: rocketmq-broker
    environment:
      - NAMESRV_ADDR=namesrv:9876
    ports:
      - "10911:10911"
      - "10909:10909"
    depends_on:
      - namesrv
    command: "sh mqbroker -n namesrv:9876"
```

### MongoDB
```yml
version: '2.2'

services:
  mongodb:
    image: mongo:4.4
    container_name: mongodb
    ports:
      - "27017:27017"
#    volumes:
#      - ./mongodb-data:/data/db
    environment:
      MONGO_INITDB_ROOT_USERNAME: admin
      MONGO_INITDB_ROOT_PASSWORD: admin
```

## 关键服务建议启动顺序

tulingmall-unqid、tulingmall-member、tulingmall-product、tulingmall-cart
tulingmall-promotion、tulingmall-authcenter
tulingmall-order-curr、tulingmall-portal、tulingmall-gateway

## 本地运行

* 商城在本地运行需要本地存在MySQL、Nacos、等基础服务。
* 服务基础配置提供 Nacos 默认配置包。导入Nacos 后自行修改项目中相关服务的配置信息。
* 秒杀系统牵涉较复杂，暂不提供本地完整运行版本